# 环境配置

本章节详细展示用户如何使用MindIE SD进行环境配置、推理执行及性能调优。用户根据各个模型的README进行推理适配与加速，README包括：模型概述、推理环境准备、快速上手、性能和精度的数据参考，模型特性（支持的硬件规格、数据类型、权重链接等）详情请参见[模型支持列表](https://www.hiascend.com/software/mindie/modellist)中的“多模态生成模型列表”页签。

MindIE安装完成后，安装路径下提供进程级环境变量设置脚本“set\_env.sh“，以自动完成环境变量设置，该脚本包含如[表1](#table1198934616167)所示中的ASCENDIE\_HOME、LD\_LIBRARY\_PATH和ASCEND\_CUSTOM\_OPP\_PATH，用户进程结束后自动失效。

**表 1**  环境变量1

<a name="table1198934616167"></a>
<table><thead align="left"><tr id="row798920462161"><th class="cellrowborder" valign="top" width="30%" id="mcps1.2.3.1.1"><p id="p1098954601614"><a name="p1098954601614"></a><a name="p1098954601614"></a>环境变量</p>
</th>
<th class="cellrowborder" valign="top" width="70%" id="mcps1.2.3.1.2"><p id="p39891546131618"><a name="p39891546131618"></a><a name="p39891546131618"></a>说明</p>
</th>
</tr>
</thead>
<tbody><tr id="row19898461167"><td class="cellrowborder" valign="top" width="30%" headers="mcps1.2.3.1.1 "><p id="p898964618167"><a name="p898964618167"></a><a name="p898964618167"></a>ASCENDIE_HOME</p>
</td>
<td class="cellrowborder" valign="top" width="70%" headers="mcps1.2.3.1.2 "><p id="p169891946101610"><a name="p169891946101610"></a><a name="p169891946101610"></a>MindIE RT软件包安装后文件存储路径。</p>
</td>
</tr>
<tr id="row134754515181"><td class="cellrowborder" valign="top" width="30%" headers="mcps1.2.3.1.1 "><p id="p1347510512186"><a name="p1347510512186"></a><a name="p1347510512186"></a>LD_LIBRARY_PATH</p>
</td>
<td class="cellrowborder" valign="top" width="70%" headers="mcps1.2.3.1.2 "><p id="p1347545161816"><a name="p1347545161816"></a><a name="p1347545161816"></a>动态库的查找路径。</p>
</td>
</tr>
<tr id="row8304021181812"><td class="cellrowborder" valign="top" width="30%" headers="mcps1.2.3.1.1 "><p id="p730422151813"><a name="p730422151813"></a><a name="p730422151813"></a>ASCEND_CUSTOM_OPP_PATH</p>
</td>
<td class="cellrowborder" valign="top" width="70%" headers="mcps1.2.3.1.2 "><p id="p5304132113187"><a name="p5304132113187"></a><a name="p5304132113187"></a>推理引擎自定义算子包安装路径。</p>
</td>
</tr>
<tr id="row188531382187"><td class="cellrowborder" valign="top" width="30%" headers="mcps1.2.3.1.1 "><p id="p18531838101815"><a name="p18531838101815"></a><a name="p18531838101815"></a>ASCEND_RT_VISIBLE_DEVICES</p>
</td>
<td class="cellrowborder" valign="top" width="70%" headers="mcps1.2.3.1.2 "><p id="p45231032112017"><a name="p45231032112017"></a><a name="p45231032112017"></a>指定当前进程所用的昇腾AI处理器的逻辑ID，如有需要请自行配置。</p>
<p id="p128531638141814"><a name="p128531638141814"></a><a name="p128531638141814"></a>配置示例："0,1,2"或"0-2"；昇腾AI处理器的逻辑ID间使用“,”表示分割，使用“-”表示连续。</p>
</td>
</tr>
</tbody>
</table>

**表 2**  环境变量2

<a name="table1980612381539"></a>
<table><thead align="left"><tr id="row10807938155315"><th class="cellrowborder" valign="top" width="19.980000000000004%" id="mcps1.2.5.1.1"><p id="zh-cn_topic_0000001678206378_p82134174820"><a name="zh-cn_topic_0000001678206378_p82134174820"></a><a name="zh-cn_topic_0000001678206378_p82134174820"></a>环境变量名</p>
</th>
<th class="cellrowborder" valign="top" width="20.540000000000003%" id="mcps1.2.5.1.2"><p id="zh-cn_topic_0000001678206378_p11213161134818"><a name="zh-cn_topic_0000001678206378_p11213161134818"></a><a name="zh-cn_topic_0000001678206378_p11213161134818"></a>说明</p>
</th>
<th class="cellrowborder" valign="top" width="47.040000000000006%" id="mcps1.2.5.1.3"><p id="p149937434118"><a name="p149937434118"></a><a name="p149937434118"></a>配置方式</p>
</th>
<th class="cellrowborder" valign="top" width="12.440000000000001%" id="mcps1.2.5.1.4"><p id="p1671518914117"><a name="p1671518914117"></a><a name="p1671518914117"></a>缺省值</p>
</th>
</tr>
</thead>
<tbody><tr id="row13807113810533"><td class="cellrowborder" valign="top" width="19.980000000000004%" headers="mcps1.2.5.1.1 "><p id="p28071038125314"><a name="p28071038125314"></a><a name="p28071038125314"></a>MINDIE_LOG_LEVEL</p>
</td>
<td class="cellrowborder" valign="top" width="20.540000000000003%" headers="mcps1.2.5.1.2 "><p id="p1180763825317"><a name="p1180763825317"></a><a name="p1180763825317"></a><span id="ph850915471163"><a name="ph850915471163"></a><a name="ph850915471163"></a>MindIE SD</span>日志级别。</p>
</td>
<td class="cellrowborder" valign="top" width="47.040000000000006%" headers="mcps1.2.5.1.3 "><p id="p116433113113"><a name="p116433113113"></a><a name="p116433113113"></a>支持配置级别"critical，error，warn，info，debug，null"，当配置为null的时候，表示日志功能关闭。</p>
<p id="p198054683413"><a name="p198054683413"></a><a name="p198054683413"></a>支持直接配置方式：export MINDIE_LOG_LEVEL="sd:debug"，其中'sd:'代表指定SD组件，也可省略直接配置export MINDIE_LOG_LEVEL="debug"。</p>
</td>
<td class="cellrowborder" valign="top" width="12.440000000000001%" headers="mcps1.2.5.1.4 "><p id="p6807103825317"><a name="p6807103825317"></a><a name="p6807103825317"></a>info</p>
</td>
</tr>
<tr id="row98078382532"><td class="cellrowborder" valign="top" width="19.980000000000004%" headers="mcps1.2.5.1.1 "><p id="p2080793895320"><a name="p2080793895320"></a><a name="p2080793895320"></a>MINDIE_LOG_TO_STDOUT</p>
</td>
<td class="cellrowborder" valign="top" width="20.540000000000003%" headers="mcps1.2.5.1.2 "><p id="p88082385533"><a name="p88082385533"></a><a name="p88082385533"></a><span id="ph760625212016"><a name="ph760625212016"></a><a name="ph760625212016"></a>MindIE SD</span>日志打印控制开关。</p>
</td>
<td class="cellrowborder" valign="top" width="47.040000000000006%" headers="mcps1.2.5.1.3 "><p id="p18191122943816"><a name="p18191122943816"></a><a name="p18191122943816"></a>支持配置"true"，"1"，"false"，"0"，配置为"true"或"1"时表示开启，配置"false"或"0"时表示关闭。</p>
<p id="p4548114734216"><a name="p4548114734216"></a><a name="p4548114734216"></a>支持直接配置方式：export MINDIE_LOG_TO_STDOUT="sd:true"，其中'sd:'代表指定SD组件，也可省略直接配置export MINDIE_LOG_TO_STDOUT="true"。</p>
</td>
<td class="cellrowborder" valign="top" width="12.440000000000001%" headers="mcps1.2.5.1.4 "><p id="p1808138125312"><a name="p1808138125312"></a><a name="p1808138125312"></a>true</p>
</td>
</tr>
<tr id="row680816388535"><td class="cellrowborder" valign="top" width="19.980000000000004%" headers="mcps1.2.5.1.1 "><p id="p1780873835317"><a name="p1780873835317"></a><a name="p1780873835317"></a>MINDIE_LOG_TO_FILE</p>
</td>
<td class="cellrowborder" valign="top" width="20.540000000000003%" headers="mcps1.2.5.1.2 "><p id="p280810380531"><a name="p280810380531"></a><a name="p280810380531"></a><span id="ph32461853172013"><a name="ph32461853172013"></a><a name="ph32461853172013"></a>MindIE SD</span>日志文件落盘控制开关。</p>
</td>
<td class="cellrowborder" valign="top" width="47.040000000000006%" headers="mcps1.2.5.1.3 "><p id="p219315394616"><a name="p219315394616"></a><a name="p219315394616"></a>支持配置"true"，"1"，"false"，"0"，配置为"true"或"1"时表示开启，配置"false"或"0"时表示关闭。</p>
<p id="p96911410204611"><a name="p96911410204611"></a><a name="p96911410204611"></a>支持直接配置方式：export MINDIE_LOG_TO_FILE="sd:true"，其中'sd:'代表指定SD组件，也可省略直接配置export MINDIE_LOG_TO_FILE="true"。</p>
</td>
<td class="cellrowborder" valign="top" width="12.440000000000001%" headers="mcps1.2.5.1.4 "><p id="p031554115465"><a name="p031554115465"></a><a name="p031554115465"></a>true</p>
</td>
</tr>
<tr id="row10808038105310"><td class="cellrowborder" valign="top" width="19.980000000000004%" headers="mcps1.2.5.1.1 "><p id="p1980873818535"><a name="p1980873818535"></a><a name="p1980873818535"></a>MINDIE_LOG_PATH</p>
</td>
<td class="cellrowborder" valign="top" width="20.540000000000003%" headers="mcps1.2.5.1.2 "><p id="p18808838145317"><a name="p18808838145317"></a><a name="p18808838145317"></a><span id="ph11941554192012"><a name="ph11941554192012"></a><a name="ph11941554192012"></a>MindIE SD</span>日志文件保存路径配置。</p>
</td>
<td class="cellrowborder" valign="top" width="47.040000000000006%" headers="mcps1.2.5.1.3 "><p id="p1475116313499"><a name="p1475116313499"></a><a name="p1475116313499"></a>支持用户指定日志落盘路径，默认为"~/mindie/log/"，其中运行日志会保存到指定路径的"debug"文件夹下。</p>
<p id="p16808153815316"><a name="p16808153815316"></a><a name="p16808153815316"></a>若用户配置输入为相对路径如"./custom_log"，则日志文件会写入"~/mindie/log/custom_log"下；若用户配置输入为绝对路径如"/home/usr/custom_log"，则日志文件会写入"/home/usr/custom_log"下。</p>
<p id="p185163035212"><a name="p185163035212"></a><a name="p185163035212"></a>支持直接配置方式：export MINDIE_LOG_PATH="sd:./custom_log"，其中'sd:'代表指定SD组件，也可省略直接配置export MINDIE_LOG_PATH="./custom_log"。</p>
</td>
<td class="cellrowborder" valign="top" width="12.440000000000001%" headers="mcps1.2.5.1.4 "><p id="p3808738105315"><a name="p3808738105315"></a><a name="p3808738105315"></a>~/mindie/log/</p>
</td>
</tr>
<tr id="row323112819554"><td class="cellrowborder" valign="top" width="19.980000000000004%" headers="mcps1.2.5.1.1 "><p id="p1223111819558"><a name="p1223111819558"></a><a name="p1223111819558"></a>MINDIE_LOG_ROTATE</p>
</td>
<td class="cellrowborder" valign="top" width="20.540000000000003%" headers="mcps1.2.5.1.2 "><p id="p192311487556"><a name="p192311487556"></a><a name="p192311487556"></a><span id="ph1895895412206"><a name="ph1895895412206"></a><a name="ph1895895412206"></a>MindIE SD</span>轮转配置。</p>
</td>
<td class="cellrowborder" valign="top" width="47.040000000000006%" headers="mcps1.2.5.1.3 "><p id="p1263616339533"><a name="p1263616339533"></a><a name="p1263616339533"></a>支持配置轮转周期"-s"，配置范围为["daily", "weekly", "monthly","yearly"]以及所有正整数，当为正整数时，轮转周期单位为daily，如"-s 100"则代表轮转周期为100天。</p>
<p id="p1328573525513"><a name="p1328573525513"></a><a name="p1328573525513"></a>支持配置日志最大文件大小"-fs"，配置范围为整数，单位为MB，如"-fs 20"代表单个日志文件最大记录大小为20MB。</p>
<p id="p126561339133419"><a name="p126561339133419"></a><a name="p126561339133419"></a>支持配置日志最大文件个数"-r"，配置范围为整数，单位为个，如"-r 10"代表最大文件记录个数为10。</p>
<p id="p131101612123613"><a name="p131101612123613"></a><a name="p131101612123613"></a>可同时配置上述参数，例：export MINDIE_LOG_ROTATE="-s 10 -fs 20 -r 10"</p>
</td>
<td class="cellrowborder" valign="top" width="12.440000000000001%" headers="mcps1.2.5.1.4 "><p id="p1323113885511"><a name="p1323113885511"></a><a name="p1323113885511"></a>-s 30 -fs 20 -r 10</p>
</td>
</tr>
<tr id="row936202113201"><td class="cellrowborder" valign="top" width="19.980000000000004%" headers="mcps1.2.5.1.1 "><p id="p1036182152014"><a name="p1036182152014"></a><a name="p1036182152014"></a>MINDIE_LOG_VERBOSE</p>
</td>
<td class="cellrowborder" valign="top" width="20.540000000000003%" headers="mcps1.2.5.1.2 "><p id="p53612218203"><a name="p53612218203"></a><a name="p53612218203"></a><span id="ph20662621122810"><a name="ph20662621122810"></a><a name="ph20662621122810"></a>MindIE SD</span>日志是否打印可选信息开关。</p>
</td>
<td class="cellrowborder" valign="top" width="47.040000000000006%" headers="mcps1.2.5.1.3 "><p id="p12361021182012"><a name="p12361021182012"></a><a name="p12361021182012"></a>支持配置"true"，"1"，"false"，"0"，配置为"true"或"1"时表示开启，配置"false"或"0"时表示关闭。</p>
<p id="p3780191812134"><a name="p3780191812134"></a><a name="p3780191812134"></a>支持直接配置方式：export MINDIE_LOG_VERBOSE="sd:true"，其中'sd:'代表指定SD组件，也可省略直接配置export MINDIE_LOG_VERBOSE="true"。</p>
</td>
<td class="cellrowborder" valign="top" width="12.440000000000001%" headers="mcps1.2.5.1.4 "><p id="p1136152152012"><a name="p1136152152012"></a><a name="p1136152152012"></a>true</p>
</td>
</tr>
</tbody>
</table>

